---

- job-template:
    name: 'MNTLAB-{student}-{child}-build-job'
    parameters:       
        - dynamic-choice:
                  name: BRANCH_NAME
                  script: |
                      def gitURL = "https://github.com/amazurenko/mntlab-jjb.git"
                      def command = "git ls-remote -h $gitURL"
                      def proc = command.execute()
                      proc.waitFor()              
                      def branches = proc.in.text.readLines().collect {{ 
                          it.replaceAll(/[a-z0-9]*\trefs\/heads\//, '') 
                      }}
                      return branches
    scm:
       - git: 
           url: 'https://github.com/amazurenko/mntlab-jjb.git'
           branches:
              - ${{BRANCH_NAME}}
    builders:
       - shell: |
           echo ${{BRANCH_NAME}}
           chmod a+x ./script.sh >> output.txt
           tar cvf ${{BUILD_TAG}}.tar.gz *.yml *.txt
    publishers:
       - archive:
            artifacts: '*.tar.gz'
            allow-empty: 'true'
            fingerprint: true
            default-excludes: false

- project:
    name: akaravai_project
    student:
       - akaravai
    child:
       - child1
       - child2
       - child3
       - child4  
    jobs:
       - 'MNTLAB-{student}-{child}-build-job'


