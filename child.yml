- job-template:
    name: "MNTLAB-{student}-child{number}-build-job"
    parameters:
          - dynamic-choice:
                name: BRANCH_NAME
                script: |
                    def gitURL = "https://github.com/amazurenko/mntlab-jjb.git"
                    def command = "git ls-remote -h $gitURL"
                    def proc = command.execute()
                    proc.waitFor()              
                    def branches = proc.in.text.readLines().collect {{ 
                        it.replaceAll(/[a-z0-9]*\trefs\/heads\//, '') 
                    }}
                    return branches
    scm:
      - git:
          url: https://github.com/amazurenko/mntlab-jjb.git 
          branches:
              - "${{BRANCH_NAME}}"
    builders:
      - shell: "bash script.sh > output.txt; tar -cvzf ${{BRANCH_NAME}}_jjb_templates.tar.gz *.yml"
    publishers:
      - archive:
          artifacts: '*.tar.gz, output.txt'
          default-excludes: false
          allow-empty: 'true'

- project:
        name: MNT
        student: "dpasiukevich"
        number:
            - 1
            - 2
            - 3
            - 4
        jobs:
            - 'MNTLAB-{student}-child{number}-build-job'
