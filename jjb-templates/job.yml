---

- job-template:
      name: 'MNTLAB-{student}-main-build-job'
      parameters:
          - dynamic-choice:
                name: BRANCH_NAME
                script: "['akhurhin', 'master']"


          - raw:
                xml: |
                    <org.biouno.unochoice.ChoiceParameter plugin="uno-choice@1.4">
                        <name>NEXT_JOB</name>
                        <description></description>
                        <randomName>choice-parameter-5545345675645</randomName>
                        <visibleItemCount>4</visibleItemCount>
                        <script class="org.biouno.unochoice.model.GroovyScript">
                        <script>import hudson.model.*
                                def jobs = []
                                hudson.model.Hudson.instance.items.findAll{{job -&gt; job}}.each {{
                                job -&gt;
                                if(job.name.startsWith(&quot;MNTLAB-akhurhin-child&quot;)) jobs &lt;&lt; job.name
                                }}
                                return jobs</script>
                                <fallbackScript></fallbackScript>
                        </script>
                        <projectName>MNTLAB-akhurhin-test-build-job</projectName>
                        <choiceType>PT_CHECKBOX</choiceType>
                        <filterable>false</filterable>
                    </org.biouno.unochoice.ChoiceParameter>

      builders:
            - trigger-builds:
                - project: "${{NEXT_JOB}}"
                  predefined-parameters:
                      BRANCH_NAME=${{BRANCH_NAME}}
                  block: true

- project:
        name: test1
        student: akhurhin
        jobs:
            - 'MNTLAB-{student}-main-build-job'

