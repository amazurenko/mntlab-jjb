- job-template:
   #child
   name: 'MNTLAB-{student}-{child}-build-job'
   parameters:
       - dynamic-choice:
             name: BRANCH_NAME
             description: "1"
             script: |
                    def gitURL = "https://github.com/amazurenko/mntlab-jjb.git"
                    def command = "git ls-remote -h $gitURL"
                    def proc = command.execute()
                    proc.waitFor()              
                    def branches = proc.in.text.readLines().collect {{ 
                        it.replaceAll(/[a-z0-9]*\trefs\/heads\//, '') 
                    }}
                    return branches
             read-only: false
   scm:
      - git:
           url: git@github.com:amazurenko/mntlab-jjb.git
           branches: 
              - ${{BRANCH_NAME}}
   builders:
      - shell: |
              sh ./script.sh
              tar cvfz ${{BRANCH_NAME}}_jjb_templates.tar.gz jjb-templates/  
- project:
   name: creating_child
   student: afrantskevitch
   child:
    # - child1  
     - child2
     - child3
     - child4
   jobs:
     - 'MNTLAB-{student}-{child}-build-job'
###############################################################################3
- job-template:
   #main
      name: 'MNTLAB-{student}-main2-build-job'
      parameters:
        - dynamic-choice:
            name: BRANCH_NAME
            description: ""
            script: "def list = [\"master\",\"afrantskevitch\"]"
            read-only: false
#      builders:
 #       - trigger-parameterized-builds:
  #         - project: ${{CHILD_JOB_NAME}}
   #          predefined-parameters: BRANCH_NAME=${{BRANCH_NAME}}
              
- project:
   name: creating_main
   student: afrantskevitch
   jobs:
     - 'MNTLAB-{student}-main2-build-job' 



   
