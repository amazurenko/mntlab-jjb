---

- job-template:
      name: 'MNTLAB-{student}-main-{target}-job'
      parameters:
          - dynamic-choice:
                name: BRANCH_NAME
                script: |
                    def list = ["karotkin", "master"]
          - raw:
                xml: |
                    <org.biouno.unochoice.ChoiceParameter plugin="uno-choice@1.4">
                        <name>BUILD_JOBS</name>
                        <description></description>
                        <randomName>choice-parameter-1372913575399876</randomName>
                        <visibleItemCount>1</visibleItemCount>
                        <script class="org.biouno.unochoice.model.GroovyScript">
                        <script>import hudson.model.*
                                def jobs = []
                                hudson.model.Hudson.instance.items.findAll{{job -&gt; job}}.each {{
                                job -&gt;
                                if(job.name.startsWith(&quot;MNTLAB-ykarotkin-child&quot;)) jobs &lt;&lt; job.name}}
                                return jobs</script>
                                <fallbackScript></fallbackScript>
                        </script>
                        <projectName>MNTLAB-ykarotkin-main-build-job</projectName>
                        <choiceType>PT_CHECKBOX</choiceType>
                        <filterable>false</filterable>
                    </org.biouno.unochoice.ChoiceParameter>

      builders:
            - trigger-builds:
                - project: "MNTLAB-karotkin-child-build-job"
                  predefined-parameters:
                      BRANCH_NAME=${{BRANCH_NAME}}
                  block: true

- project:
        name: MNT-parent
        student: "karotkin"
        target: build
        jobs:
            - 'MNTLAB-{student}-main-{target}-job'
